name: Test Permissions
on: workflow_dispatch
run-name: Test Permissions
env:
  DATE: (date +'%Y-%m-%d')
  BRANCH_NAME: "test/permissions-${DATE}-${{ github.run_id }}"

jobs:
  test:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - uses: actions/checkout@v6
        with:
          fetch-depth: 0
      - name: Setup Git bot user
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
      - name: Setup Variables
        run: |
          DATE=$(date +'%Y-%m-%d')
          BRANCH_NAME="test/permissions-${DATE}-${{ github.run_id }}"

          echo "BRANCH_NAME=$BRANCH_NAME" >> $GITHUB_ENV
      - name: Test push
        run: |
          # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—É—é –≤–µ—Ç–∫—É
          git checkout -b "$BRANCH_NAME"
          echo "test" > test-file.txt
          git add test-file.txt
          git commit -m "Test commit"

          # –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–ø—É—à–∏—Ç—å
          git push --set-upstream origin ${{env.BRANCH_NAME}} || echo "‚ùå Push failed"
      - name: create PR
        run: |
          # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π PR –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ä–µ–ø–æ
          gh pr create \
            --title "üé® Design sync:" \
            --body "Auto-synced from fork PR " \
            --base main \
            --head "${{env.BRANCH_NAME}}" \
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
