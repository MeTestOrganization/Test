name: Test Permissions
on: workflow_dispatch

jobs:
  test:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
      
    steps:
      - uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      - name: Setup Git bot user
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
      - name: Test push
        run: |
          # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—É—é –≤–µ—Ç–∫—É
          git checkout -b test-permissions-$(date +%s)
          echo "test" > test-file.txt
          git add test-file.txt
          git commit -m "Test commit"
          
          # –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–ø—É—à–∏—Ç—å
          git push origin HEAD || echo "‚ùå Push failed"
      - name: create PR
        run: | 
          # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π PR –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ä–µ–ø–æ
          gh pr create \
            --title "üé® Design sync: ${{ github.event.pull_request.title }}" \
            --body "Auto-synced from fork PR #${{ github.event.pull_request.number }}" \
            --base main \
            --head test-permissions-$(date +%s) \
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
